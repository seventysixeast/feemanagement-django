{% extends "admin/base_site.html" %}
{% block content %}

  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
  </form>

  {% if results %}
    <h2>Results</h2>
    <a href="{% url 'admin:export_defaulters_csv' %}">Export to CSV</a> 
    <table>
      <thead>
        <tr>
          <th>Admission No</th>
          <th>Student Name</th>
          <th>Class</th>
          <th>Unpaid Months</th>
        </tr>
      </thead>
      <tbody>
        {% for result in results %}
          {% if not result.months_paid or result.months_paid != "All Months Paid" %}
            <tr>
              <td>{{ result.student_id__addmission_no }}</td>
              <td>{{ result.student_id__student_name }}</td>
              <td>{{ result.student_class }}</td>
              <td>
                {% if result.months_paid %}
                  {{ result.months_paid }}
                {% else %}
                  All Months Unpaid
                {% endif %}
              </td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No defaulters found for the selected criteria.</p>
  {% endif %}

{% endblock %}
